<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurtleBlocks 2025 - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            padding: 5px;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .help-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
            height: calc(100vh - 150px);
        }

        .categories {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            overflow-y: auto;
        }

        .category {
            margin-bottom: 20px;
        }

        .category h3 {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .blocks-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .block {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            user-select: none;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .block:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .workspace {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .stage-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #stage {
            background: #fff;
            border-radius: 8px;
            display: block;
        }

        .code-area {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            min-height: 250px;
        }

        .code-line {
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
            padding: 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: move;
            user-select: none;
            position: relative;
            border-left: 4px solid;
        }

        .code-line.motion { border-left-color: #4CAF50; }
        .code-line.looks { border-left-color: #9966CC; }
        .code-line.sound { border-left-color: #DDA0DD; }
        .code-line.pen { border-left-color: #FFA500; }
        .code-line.control { border-left-color: #FF6B6B; }
        .code-line.sensing { border-left-color: #5C6BC0; }
        .code-line.advanced { border-left-color: #26C6DA; }

        .code-line .delete-btn {
            position: absolute;
            right: 10px;
            background: rgba(255, 0, 0, 0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .code-line .delete-btn:hover {
            background: rgba(255, 0, 0, 0.5);
        }

        .properties {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            overflow-y: auto;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-group h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #ffcc00;
        }

        .property {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
        }

        .property label {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .property input, .property select {
            padding: 8px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .turtle {
            position: absolute;
            width: 80px;
            height: 80px;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 30px;
            border-radius: 15px;
            width: 600px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h2 {
            margin-bottom: 20px;
            text-align: center;
            color: #ffcc00;
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
        }

        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .block-input {
            width: 50px;
            padding: 2px 5px;
            border: none;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-align: center;
        }

        .program-stats {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .sensor-value {
            background: rgba(0, 255, 0, 0.2);
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
        }

        .speech-bubble {
            position: absolute;
            background: white;
            color: black;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 200px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            display: none;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
            }
            
            .categories, .properties {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="https://i0.wp.com/gas-kvas.com/grafic/uploads/posts/2024-01/gas-kvas-com-p-cherepakha-dlya-detei-na-prozrachnom-fone-4.png?ssl=1" alt="TurtleBlocks Logo">
                <h1>TurtleBlocks 2025</h1>
            </div>
            <button class="help-btn" id="help-btn">
                <span>‚ùì –ü–æ–º–æ—â—å</span>
            </button>
        </header>

        <div class="main-content">
            <div class="categories">
                <!-- –î–≤–∏–∂–µ–Ω–∏–µ -->
                <div class="category">
                    <h3>üöÄ –î–≤–∏–∂–µ–Ω–∏–µ</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="move" data-category="motion">
                            <div>–ò–¥—Ç–∏ <input type="number" class="block-input" value="10"> —à–∞–≥–æ–≤</div>
                        </div>
                        <div class="block" data-type="turnRight" data-category="motion">
                            <div>–ü–æ–≤–µ—Ä–Ω—É—Ç—å ‚Üª <input type="number" class="block-input" value="15">¬∞</div>
                        </div>
                        <div class="block" data-type="turnLeft" data-category="motion">
                            <div>–ü–æ–≤–µ—Ä–Ω—É—Ç—å ‚Ü∫ <input type="number" class="block-input" value="15">¬∞</div>
                        </div>
                        <div class="block" data-type="goto" data-category="motion">
                            <div>–ü–µ—Ä–µ–π—Ç–∏ –≤ x:<input type="number" class="block-input" value="0"> y:<input type="number" class="block-input" value="0"></div>
                        </div>
                        <div class="block" data-type="pointToMouse" data-category="motion">
                            <div>–ù–∞–ø—Ä–∞–≤–∏—Ç—å—Å—è –∫ –º—ã—à–∏</div>
                        </div>
                        <div class="block" data-type="setDirection" data-category="motion">
                            <div>–ù–∞–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ <input type="number" class="block-input" value="90">¬∞</div>
                        </div>
                    </div>
                </div>
                
                <!-- –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
                <div class="category">
                    <h3>üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="say" data-category="looks">
                            <div>–°–∫–∞–∑–∞—Ç—å <input type="text" class="block-input" value="–ü—Ä–∏–≤–µ—Ç!"></div>
                        </div>
                        <div class="block" data-type="think" data-category="looks">
                            <div>–î—É–º–∞—Ç—å <input type="text" class="block-input" value="–û —á–µ–º-—Ç–æ"></div>
                        </div>
                        <div class="block" data-type="show" data-category="looks">–ü–æ–∫–∞–∑–∞—Ç—å—Å—è</div>
                        <div class="block" data-type="hide" data-category="looks">–°–ø—Ä—è—Ç–∞—Ç—å—Å—è</div>
                        <div class="block" data-type="changeSize" data-category="looks">
                            <div>–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –Ω–∞ <input type="number" class="block-input" value="10"></div>
                        </div>
                    </div>
                </div>
                
                <!-- –ó–≤—É–∫ -->
                <div class="category">
                    <h3>üéµ –ó–≤—É–∫</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="playSound" data-category="sound">–ò–≥—Ä–∞—Ç—å –∑–≤—É–∫</div>
                        <div class="block" data-type="stopSounds" data-category="sound">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–≤—É–∫–∏</div>
                        <div class="block" data-type="beep" data-category="sound">–ò–∑–¥–∞—Ç—å –∑–≤—É–∫</div>
                        <div class="block" data-type="playNote" data-category="sound">
                            <div>–ò–≥—Ä–∞—Ç—å –Ω–æ—Ç—É <input type="number" class="block-input" value="60"></div>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–µ—Ä–æ -->
                <div class="category">
                    <h3>‚úèÔ∏è –ü–µ—Ä–æ</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="penDown" data-category="pen">–û–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–æ</div>
                        <div class="block" data-type="penUp" data-category="pen">–ü–æ–¥–Ω—è—Ç—å –ø–µ—Ä–æ</div>
                        <div class="block" data-type="setPenColor" data-category="pen">
                            <div>–¶–≤–µ—Ç –ø–µ—Ä–∞ <input type="color" class="block-input" value="#ff0000"></div>
                        </div>
                        <div class="block" data-type="setPenSize" data-category="pen">
                            <div>–ó–∞–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–∞ <input type="number" class="block-input" value="2"></div>
                        </div>
                        <div class="block" data-type="stamp" data-category="pen">–®—Ç–∞–º–ø</div>
                        <div class="block" data-type="clear" data-category="pen">–û—á–∏—Å—Ç–∏—Ç—å</div>
                    </div>
                </div>
                
                <!-- –°–æ–±—ã—Ç–∏—è -->
                <div class="category">
                    <h3>üïπÔ∏è –°–æ–±—ã—Ç–∏—è</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="whenRun" data-category="control">–ö–æ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω–æ</div>
                        <div class="block" data-type="whenClicked" data-category="control">–ö–æ–≥–¥–∞ —â–µ–ª–∫–Ω—É—Ç –ø–æ —á–µ—Ä–µ–ø–∞—Ö–µ</div>
                        <div class="block" data-type="whenKeyPressed" data-category="control">
                            <div>–ö–æ–≥–¥–∞ –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ <input type="text" class="block-input" value="–ø—Ä–æ–±–µ–ª"></div>
                        </div>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="category">
                    <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="wait" data-category="control">
                            <div>–ñ–¥–∞—Ç—å <input type="number" class="block-input" value="1"> —Å–µ–∫</div>
                        </div>
                        <div class="block" data-type="repeat" data-category="control">
                            <div>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å <input type="number" class="block-input" value="10"> —Ä–∞–∑</div>
                        </div>
                        <div class="block" data-type="forever" data-category="control">–ü–æ–≤—Ç–æ—Ä—è—Ç—å –≤—Å–µ–≥–¥–∞</div>
                        <div class="block" data-type="stopAll" data-category="control">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë</div>
                    </div>
                </div>
                
                <!-- –°–µ–Ω—Å–æ—Ä—ã -->
                <div class="category">
                    <h3>üéØ –°–µ–Ω—Å–æ—Ä—ã</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="touchingMouse" data-category="sensing">–ö–∞—Å–∞–µ—Ç—Å—è –º—ã—à–∏?</div>
                        <div class="block" data-type="touchingEdge" data-category="sensing">–ö–∞—Å–∞–µ—Ç—Å—è –∫—Ä–∞—è?</div>
                        <div class="block" data-type="mouseX" data-category="sensing">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X –º—ã—à–∏</div>
                        <div class="block" data-type="mouseY" data-category="sensing">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y –º—ã—à–∏</div>
                        <div class="block" data-type="keyPressed" data-category="sensing">
                            <div>–ö–ª–∞–≤–∏—à–∞ <input type="text" class="block-input" value="–ø—Ä–æ–±–µ–ª"> –Ω–∞–∂–∞—Ç–∞?</div>
                        </div>
                        <div class="block" data-type="distanceToMouse" data-category="sensing">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –º—ã—à–∏</div>
                        <div class="block" data-type="timer" data-category="sensing">–¢–∞–π–º–µ—Ä</div>
                    </div>
                </div>

                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ -->
                <div class="category">
                    <h3>üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ</h3>
                    <div class="blocks-container">
                        <div class="block" data-type="chaseMouse" data-category="advanced">–ü—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å –º—ã—à—å</div>
                        <div class="block" data-type="wasdControls" data-category="advanced">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD</div>
                        <div class="block" data-type="drawSquare" data-category="advanced">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç</div>
                        <div class="block" data-type="drawTriangle" data-category="advanced">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫</div>
                        <div class="block" data-type="drawCircle" data-category="advanced">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫—Ä—É–≥</div>
                        <div class="block" data-type="drawStar" data-category="advanced">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∑–≤–µ–∑–¥—É</div>
                        <div class="block" data-type="drawSpiral" data-category="advanced">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Å–ø–∏—Ä–∞–ª—å</div>
                    </div>
                </div>

                <div class="program-stats">
                    <div>–ë–ª–æ–∫–æ–≤ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ: <span id="block-count">0</span></div>
                    <div style="margin-top: 5px;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–ª–æ–∫–∏ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É</div>
                </div>
            </div>

            <div class="workspace">
                <div class="stage-container">
                    <canvas id="stage" width="600" height="400"></canvas>
                    <img src="https://i0.wp.com/gas-kvas.com/grafic/uploads/posts/2024-01/gas-kvas-com-p-cherepakha-dlya-detei-na-prozrachnom-fone-4.png?ssl=1" alt="Turtle" class="turtle" id="turtle">
                    <div class="speech-bubble" id="speech-bubble"></div>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" id="run-btn">
                        <span>‚ñ∂ –ó–∞–ø—É—Å–∫</span>
                    </button>
                    <button class="btn btn-secondary" id="stop-btn">
                        <span>‚èπ –°—Ç–æ–ø</span>
                    </button>
                    <button class="btn btn-secondary" id="clear-btn">
                        <span>üóë –û—á–∏—Å—Ç–∏—Ç—å</span>
                    </button>
                    <button class="btn btn-secondary" id="example-btn">
                        <span>üìã –ü—Ä–∏–º–µ—Ä—ã</span>
                    </button>
                </div>
                <div class="code-area" id="code-area">
                    <!-- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>

            <div class="properties">
                <div class="property-group">
                    <h3>üê¢ –°–≤–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–ø–∞—Ö–∏</h3>
                    <div class="property">
                        <label>–ü–æ–∑–∏—Ü–∏—è X: <span class="sensor-value" id="turtle-x">300</span></label>
                    </div>
                    <div class="property">
                        <label>–ü–æ–∑–∏—Ü–∏—è Y: <span class="sensor-value" id="turtle-y">200</span></label>
                    </div>
                    <div class="property">
                        <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: <span class="sensor-value" id="turtle-direction">90¬∞</span></label>
                    </div>
                    <div class="property">
                        <label>–°–∫–æ—Ä–æ—Å—Ç—å: <span class="sensor-value" id="turtle-speed">5</span></label>
                        <input type="range" id="speed-control" min="1" max="10" value="5">
                    </div>
                </div>
                
                <div class="property-group">
                    <h3>‚úèÔ∏è –°–≤–æ–π—Å—Ç–≤–∞ –ø–µ—Ä–∞</h3>
                    <div class="property">
                        <label for="pen-color">–¶–≤–µ—Ç –ø–µ—Ä–∞:</label>
                        <input type="color" id="pen-color" value="#ff0000">
                    </div>
                    <div class="property">
                        <label for="pen-size">–†–∞–∑–º–µ—Ä –ø–µ—Ä–∞: <span id="pen-size-value">2</span></label>
                        <input type="range" id="pen-size" min="1" max="10" value="2">
                    </div>
                </div>
                
                <div class="property-group">
                    <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div class="property">
                        <label>–°—Ç–∞—Ç—É—Å: <span class="sensor-value" id="status">–ì–æ—Ç–æ–≤</span></label>
                    </div>
                    <div class="property">
                        <label>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: <span class="sensor-value" id="execution-time">0</span> —Å–µ–∫</label>
                    </div>
                    <div class="property">
                        <label>–¢–∞–π–º–µ—Ä: <span class="sensor-value" id="timer-value">0.0</span></label>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" id="save-project">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
                    <button class="btn btn-secondary" id="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
                </div>
            </div>
        </div>

        <footer>
            <p>TurtleBlocks &copy; 2025 - –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑—Ä–∞—Å—Ç–æ–≤</p>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–º–µ—Ä–æ–≤ -->
    <div class="modal" id="examples-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-examples-modal">&times;</span>
            <h2>–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–≥—Ä–∞–º–º</h2>
            <div style="margin: 20px 0;">
                <button class="btn btn-primary" id="example-square">–ö–≤–∞–¥—Ä–∞—Ç</button>
                <button class="btn btn-primary" id="example-spiral">–°–ø–∏—Ä–∞–ª—å</button>
                <button class="btn btn-primary" id="example-star">–ó–≤–µ–∑–¥–∞</button>
                <button class="btn btn-primary" id="example-circle">–ö—Ä—É–≥</button>
                <button class="btn btn-primary" id="example-house">–î–æ–º–∏–∫</button>
                <button class="btn btn-primary" id="example-animation">–ê–Ω–∏–º–∞—Ü–∏—è</button>
            </div>
            <div class="buttons">
                <button class="btn btn-secondary" id="close-examples">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const stage = document.getElementById('stage');
        const ctx = stage.getContext('2d');
        const turtle = document.getElementById('turtle');
        const codeArea = document.getElementById('code-area');
        const speechBubble = document.getElementById('speech-bubble');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–ø–∞—Ö–∏
        let turtleState = {
            x: stage.width / 2,
            y: stage.height / 2,
            direction: 90,
            visible: true,
            penDown: true,
            penColor: '#ff0000',
            penSize: 2,
            isRunning: false,
            speed: 5,
            timer: 0,
            timerStart: 0
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        let currentProgram = null;
        let isExecuting = false;
        let pressedKeys = new Set();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            resetStage();
            updateTurtlePosition();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –±–ª–æ–∫–æ–≤
            document.querySelectorAll('.block').forEach(block => {
                block.addEventListener('click', handleBlockClick);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('run-btn').addEventListener('click', runProgram);
            document.getElementById('stop-btn').addEventListener('click', stopProgram);
            document.getElementById('clear-btn').addEventListener('click', clearProgram);
            document.getElementById('example-btn').addEventListener('click', () => {
                document.getElementById('examples-modal').style.display = 'flex';
            });
            document.getElementById('reset-btn').addEventListener('click', resetAll);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏–º–µ—Ä–æ–≤
            document.getElementById('close-examples-modal').addEventListener('click', () => {
                document.getElementById('examples-modal').style.display = 'none';
            });
            document.getElementById('close-examples').addEventListener('click', () => {
                document.getElementById('examples-modal').style.display = 'none';
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏–º–µ—Ä–æ–≤
            document.getElementById('example-square').addEventListener('click', () => loadExample('square'));
            document.getElementById('example-spiral').addEventListener('click', () => loadExample('spiral'));
            document.getElementById('example-star').addEventListener('click', () => loadExample('star'));
            document.getElementById('example-circle').addEventListener('click', () => loadExample('circle'));
            document.getElementById('example-house').addEventListener('click', () => loadExample('house'));
            document.getElementById('example-animation').addEventListener('click', () => loadExample('animation'));
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–æ–π—Å—Ç–≤
            document.getElementById('pen-color').addEventListener('input', (e) => {
                turtleState.penColor = e.target.value;
            });
            
            document.getElementById('pen-size').addEventListener('input', (e) => {
                turtleState.penSize = parseInt(e.target.value);
                document.getElementById('pen-size-value').textContent = turtleState.penSize;
            });
            
            document.getElementById('speed-control').addEventListener('input', (e) => {
                turtleState.speed = parseInt(e.target.value);
                document.getElementById('turtle-speed').textContent = turtleState.speed;
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            turtleState.timerStart = Date.now();
            setInterval(updateTimer, 100);
            
            updateSensors();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –±–ª–æ–∫—É
        function handleBlockClick(e) {
            const block = e.currentTarget;
            const type = block.dataset.type;
            const category = block.dataset.category;
            const inputs = block.querySelectorAll('input');
            const params = {};
            
            inputs.forEach(input => {
                if (input.type === 'number') {
                    params.number = parseInt(input.value);
                } else if (input.type === 'color') {
                    params.color = input.value;
                } else {
                    params.text = input.value;
                }
            });
            
            addBlockToProgram(type, category, params);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
        function addBlockToProgram(type, category, params) {
            const blockElement = document.createElement('div');
            blockElement.className = `code-line ${category}`;
            blockElement.dataset.type = type;
            blockElement.dataset.category = category;
            
            let content = '';
            let displayParams = { ...params };
            
            switch(type) {
                case 'move':
                    content = `–ò–¥—Ç–∏ ${displayParams.number || 10} —à–∞–≥–æ–≤`;
                    break;
                case 'turnRight':
                    content = `–ü–æ–≤–µ—Ä–Ω—É—Ç—å ‚Üª ${displayParams.number || 15}¬∞`;
                    break;
                case 'turnLeft':
                    content = `–ü–æ–≤–µ—Ä–Ω—É—Ç—å ‚Ü∫ ${displayParams.number || 15}¬∞`;
                    break;
                case 'goto':
                    content = `–ü–µ—Ä–µ–π—Ç–∏ –≤ x:${displayParams.number || 0} y:${displayParams.number || 0}`;
                    break;
                case 'pointToMouse':
                    content = '–ù–∞–ø—Ä–∞–≤–∏—Ç—å—Å—è –∫ –º—ã—à–∏';
                    break;
                case 'setDirection':
                    content = `–ù–∞–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ ${displayParams.number || 90}¬∞`;
                    break;
                case 'say':
                    content = `–°–∫–∞–∑–∞—Ç—å "${displayParams.text || '–ü—Ä–∏–≤–µ—Ç!'}"`;
                    break;
                case 'think':
                    content = `–î—É–º–∞—Ç—å "${displayParams.text || '–û —á–µ–º-—Ç–æ'}"`;
                    break;
                case 'show':
                    content = '–ü–æ–∫–∞–∑–∞—Ç—å—Å—è';
                    break;
                case 'hide':
                    content = '–°–ø—Ä—è—Ç–∞—Ç—å—Å—è';
                    break;
                case 'changeSize':
                    content = `–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –Ω–∞ ${displayParams.number || 10}`;
                    break;
                case 'playSound':
                    content = '–ò–≥—Ä–∞—Ç—å –∑–≤—É–∫';
                    break;
                case 'stopSounds':
                    content = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–≤—É–∫–∏';
                    break;
                case 'beep':
                    content = '–ò–∑–¥–∞—Ç—å –∑–≤—É–∫';
                    break;
                case 'playNote':
                    content = `–ò–≥—Ä–∞—Ç—å –Ω–æ—Ç—É ${displayParams.number || 60}`;
                    break;
                case 'penDown':
                    content = '–û–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–æ';
                    break;
                case 'penUp':
                    content = '–ü–æ–¥–Ω—è—Ç—å –ø–µ—Ä–æ';
                    break;
                case 'setPenColor':
                    content = `–¶–≤–µ—Ç –ø–µ—Ä–∞ ${displayParams.color || '#ff0000'}`;
                    break;
                case 'setPenSize':
                    content = `–ó–∞–¥–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–∞ ${displayParams.number || 2}`;
                    break;
                case 'stamp':
                    content = '–®—Ç–∞–º–ø';
                    break;
                case 'clear':
                    content = '–û—á–∏—Å—Ç–∏—Ç—å';
                    break;
                case 'whenRun':
                    content = '–ö–æ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω–æ';
                    break;
                case 'whenClicked':
                    content = '–ö–æ–≥–¥–∞ —â–µ–ª–∫–Ω—É—Ç –ø–æ —á–µ—Ä–µ–ø–∞—Ö–µ';
                    break;
                case 'whenKeyPressed':
                    content = `–ö–æ–≥–¥–∞ –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ "${displayParams.text || '–ø—Ä–æ–±–µ–ª'}"`;
                    break;
                case 'wait':
                    content = `–ñ–¥–∞—Ç—å ${displayParams.number || 1} —Å–µ–∫—É–Ω–¥`;
                    break;
                case 'repeat':
                    content = `–ü–æ–≤—Ç–æ—Ä–∏—Ç—å ${displayParams.number || 10} —Ä–∞–∑`;
                    break;
                case 'forever':
                    content = '–ü–æ–≤—Ç–æ—Ä—è—Ç—å –≤—Å–µ–≥–¥–∞';
                    break;
                case 'stopAll':
                    content = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë';
                    break;
                case 'touchingMouse':
                    content = '–ö–∞—Å–∞–µ—Ç—Å—è –º—ã—à–∏?';
                    break;
                case 'touchingEdge':
                    content = '–ö–∞—Å–∞–µ—Ç—Å—è –∫—Ä–∞—è?';
                    break;
                case 'mouseX':
                    content = '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X –º—ã—à–∏';
                    break;
                case 'mouseY':
                    content = '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y –º—ã—à–∏';
                    break;
                case 'keyPressed':
                    content = `–ö–ª–∞–≤–∏—à–∞ "${displayParams.text || '–ø—Ä–æ–±–µ–ª'}" –Ω–∞–∂–∞—Ç–∞?`;
                    break;
                case 'distanceToMouse':
                    content = '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –º—ã—à–∏';
                    break;
                case 'timer':
                    content = '–¢–∞–π–º–µ—Ä';
                    break;
                case 'chaseMouse':
                    content = '–ü—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å –º—ã—à—å';
                    break;
                case 'wasdControls':
                    content = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD';
                    break;
                case 'drawSquare':
                    content = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç';
                    break;
                case 'drawTriangle':
                    content = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫';
                    break;
                case 'drawCircle':
                    content = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫—Ä—É–≥';
                    break;
                case 'drawStar':
                    content = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∑–≤–µ–∑–¥—É';
                    break;
                case 'drawSpiral':
                    content = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Å–ø–∏—Ä–∞–ª—å';
                    break;
            }
            
            blockElement.innerHTML = `
                ${content}
                <button class="delete-btn">‚ùå</button>
            `;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ dataset
            if (params.number) blockElement.dataset.number = params.number;
            if (params.text) blockElement.dataset.text = params.text;
            if (params.color) blockElement.dataset.color = params.color;
            
            blockElement.querySelector('.delete-btn').addEventListener('click', function() {
                blockElement.remove();
                updateBlockCount();
            });
            
            codeArea.appendChild(blockElement);
            updateBlockCount();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–∞
        function loadExample(example) {
            clearProgram();
            
            switch(example) {
                case 'square':
                    addBlockToProgram('whenRun', 'control');
                    addBlockToProgram('penDown', 'pen');
                    addBlockToProgram('repeat', 'control', {number: 4});
                    addBlockToProgram('move', 'motion', {number: 100});
                    addBlockToProgram('turnRight', 'motion', {number: 90});
                    break;
                case 'spiral':
                    addBlockToProgram('whenRun', 'control');
                    addBlockToProgram('penDown', 'pen');
                    addBlockToProgram('forever', 'control');
                    addBlockToProgram('move', 'motion', {number: 10});
                    addBlockToProgram('turnRight', 'motion', {number: 89});
                    break;
                case 'star':
                    addBlockToProgram('whenRun', 'control');
                    addBlockToProgram('penDown', 'pen');
                    addBlockToProgram('drawStar', 'advanced');
                    break;
                case 'circle':
                    addBlockToProgram('whenRun', 'control');
                    addBlockToProgram('penDown', 'pen');
                    addBlockToProgram('drawCircle', 'advanced');
                    break;
                case 'house':
                    addBlockToProgram('whenRun', 'control');
                    addBlockToProgram('penDown', 'pen');
                    addBlockToProgram('drawSquare', 'advanced');
                    addBlockToProgram('move', 'motion', {number: 100});
                    addBlockToProgram('turnRight', 'motion', {number: 30});
                    addBlockToProgram('drawTriangle', 'advanced');
                    break;
                case 'animation':
                    addBlockToProgram('whenRun', 'control');
                    addBlockToProgram('forever', 'control');
                    addBlockToProgram('move', 'motion', {number: 5});
                    addBlockToProgram('turnRight', 'motion', {number: 10});
                    addBlockToProgram('wait', 'control', {number: 0.1});
                    break;
            }
            
            document.getElementById('examples-modal').style.display = 'none';
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
        async function runProgram() {
            if (turtleState.isRunning) return;
            
            turtleState.isRunning = true;
            isExecuting = true;
            document.getElementById('status').textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è';
            document.getElementById('run-btn').disabled = true;
            
            const startTime = Date.now();
            const blocks = Array.from(codeArea.children);
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –±–ª–æ–∫–∏
            for (const block of blocks) {
                if (!turtleState.isRunning) break;
                await executeBlock(block);
            }
            
            const endTime = Date.now();
            document.getElementById('execution-time').textContent = ((endTime - startTime) / 1000).toFixed(1);
            document.getElementById('status').textContent = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
            document.getElementById('run-btn').disabled = false;
            turtleState.isRunning = false;
            isExecuting = false;
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∞
        async function executeBlock(block) {
            if (!turtleState.isRunning) return;
            
            const type = block.dataset.type;
            const category = block.dataset.category;
            const number = parseInt(block.dataset.number) || 0;
            const text = block.dataset.text || '';
            const color = block.dataset.color || '';
            
            const speed = 110 - (turtleState.speed * 10); // –û–±—Ä–∞—Ç–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
            
            switch(type) {
                case 'move':
                    await moveTurtle(number || 10, speed);
                    break;
                case 'turnRight':
                    turnTurtle(number || 15);
                    await delay(speed);
                    break;
                case 'turnLeft':
                    turnTurtle(-(number || 15));
                    await delay(speed);
                    break;
                case 'goto':
                    gotoPosition(0, 0);
                    await delay(speed);
                    break;
                case 'pointToMouse':
                    pointToMouse();
                    await delay(speed);
                    break;
                case 'setDirection':
                    setDirection(number || 90);
                    await delay(speed);
                    break;
                case 'say':
                    await say(text || '–ü—Ä–∏–≤–µ—Ç!');
                    break;
                case 'think':
                    await think(text || '–û —á–µ–º-—Ç–æ');
                    break;
                case 'show':
                    showTurtle();
                    await delay(speed);
                    break;
                case 'hide':
                    hideTurtle();
                    await delay(speed);
                    break;
                case 'changeSize':
                    changeSize(number || 10);
                    await delay(speed);
                    break;
                case 'playSound':
                    playSound();
                    await delay(speed);
                    break;
                case 'stopSounds':
                    stopSounds();
                    await delay(speed);
                    break;
                case 'beep':
                    beep();
                    await delay(speed);
                    break;
                case 'playNote':
                    playNote(number || 60);
                    await delay(speed);
                    break;
                case 'penDown':
                    penDown();
                    await delay(speed);
                    break;
                case 'penUp':
                    penUp();
                    await delay(speed);
                    break;
                case 'setPenColor':
                    setPenColor(color || '#ff0000');
                    await delay(speed);
                    break;
                case 'setPenSize':
                    setPenSize(number || 2);
                    await delay(speed);
                    break;
                case 'stamp':
                    stamp();
                    await delay(speed);
                    break;
                case 'clear':
                    clear();
                    await delay(speed);
                    break;
                case 'whenRun':
                    // –ë–ª–æ–∫-—Ç—Ä–∏–≥–≥–µ—Ä, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
                    await delay(speed);
                    break;
                case 'whenClicked':
                    // –ë–ª–æ–∫-—Ç—Ä–∏–≥–≥–µ—Ä, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
                    await delay(speed);
                    break;
                case 'whenKeyPressed':
                    // –ë–ª–æ–∫-—Ç—Ä–∏–≥–≥–µ—Ä, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
                    await delay(speed);
                    break;
                case 'wait':
                    await delay((number || 1) * 1000);
                    break;
                case 'repeat':
                    const repeatCount = number || 10;
                    const repeatBlocks = getBlocksAfter(block);
                    for (let i = 0; i < repeatCount && turtleState.isRunning; i++) {
                        for (const repeatBlock of repeatBlocks) {
                            if (!turtleState.isRunning) break;
                            await executeBlock(repeatBlock);
                        }
                    }
                    break;
                case 'forever':
                    const foreverBlocks = getBlocksAfter(block);
                    while (turtleState.isRunning) {
                        for (const foreverBlock of foreverBlocks) {
                            if (!turtleState.isRunning) break;
                            await executeBlock(foreverBlock);
                        }
                    }
                    break;
                case 'stopAll':
                    stopProgram();
                    break;
                case 'chaseMouse':
                    await chaseMouse();
                    break;
                case 'wasdControls':
                    enableWASDControls();
                    await delay(speed);
                    break;
                case 'drawSquare':
                    await drawSquare();
                    break;
                case 'drawTriangle':
                    await drawTriangle();
                    break;
                case 'drawCircle':
                    await drawCircle();
                    break;
                case 'drawStar':
                    await drawStar();
                    break;
                case 'drawSpiral':
                    await drawSpiral();
                    break;
            }
            
            updateSensors();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è —á–µ—Ä–µ–ø–∞—Ö–∏
        async function moveTurtle(steps, speed = 50) {
            const stepsPerFrame = Math.max(1, Math.ceil(steps / 10));
            const totalSteps = Math.abs(steps);
            const direction = steps > 0 ? 1 : -1;
            
            for (let i = 0; i < totalSteps && turtleState.isRunning; i += stepsPerFrame) {
                const currentSteps = Math.min(stepsPerFrame, totalSteps - i);
                const radians = turtleState.direction * Math.PI / 180;
                const newX = turtleState.x + (currentSteps * direction) * Math.cos(radians);
                const newY = turtleState.y - (currentSteps * direction) * Math.sin(radians);
                
                if (turtleState.penDown) {
                    ctx.beginPath();
                    ctx.strokeStyle = turtleState.penColor;
                    ctx.lineWidth = turtleState.penSize;
                    ctx.lineCap = 'round';
                    ctx.moveTo(turtleState.x, turtleState.y);
                    ctx.lineTo(newX, newY);
                    ctx.stroke();
                }
                
                turtleState.x = newX;
                turtleState.y = newY;
                updateTurtlePosition();
                await delay(speed);
            }
        }

        function turnTurtle(degrees) {
            turtleState.direction = (turtleState.direction + degrees) % 360;
            if (turtleState.direction < 0) turtleState.direction += 360;
            updateTurtlePosition();
        }

        function gotoPosition(x, y) {
            turtleState.x = x;
            turtleState.y = y;
            updateTurtlePosition();
        }

        function pointToMouse() {
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –º—ã—à–∏
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –º—ã—à–∏
            updateTurtlePosition();
        }

        function setDirection(degrees) {
            turtleState.direction = degrees;
            updateTurtlePosition();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
        async function say(text) {
            speechBubble.textContent = text;
            speechBubble.style.display = 'block';
            speechBubble.style.left = (turtleState.x + 50) + 'px';
            speechBubble.style.top = (turtleState.y - 40) + 'px';
            
            await delay(2000);
            speechBubble.style.display = 'none';
        }

        async function think(text) {
            speechBubble.textContent = text;
            speechBubble.style.display = 'block';
            speechBubble.style.left = (turtleState.x + 50) + 'px';
            speechBubble.style.top = (turtleState.y - 40) + 'px';
            speechBubble.style.fontStyle = 'italic';
            
            await delay(2000);
            speechBubble.style.display = 'none';
            speechBubble.style.fontStyle = 'normal';
        }

        function showTurtle() {
            turtleState.visible = true;
            updateTurtlePosition();
        }

        function hideTurtle() {
            turtleState.visible = false;
            updateTurtlePosition();
        }

        function changeSize(change) {
            const currentSize = parseInt(turtle.style.width) || 80;
            const newSize = Math.max(20, Math.min(150, currentSize + change));
            turtle.style.width = newSize + 'px';
            turtle.style.height = newSize + 'px';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∑–≤—É–∫–∞
        function playSound() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
            console.log("–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞");
        }

        function stopSounds() {
            console.log("–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤");
        }

        function beep() {
            // –ü—Ä–æ—Å—Ç–æ–π beep —á–µ—Ä–µ–∑ Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("–ó–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
            }
        }

        function playNote(note) {
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–æ—Ç—ã
            console.log(`–ò–≥—Ä–∞–µ–º –Ω–æ—Ç—É: ${note}`);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–∞
        function penDown() {
            turtleState.penDown = true;
        }

        function penUp() {
            turtleState.penDown = false;
        }

        function setPenColor(color) {
            turtleState.penColor = color;
        }

        function setPenSize(size) {
            turtleState.penSize = size;
        }

        function stamp() {
            // –°–æ–∑–¥–∞–Ω–∏–µ —à—Ç–∞–º–ø–∞ - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–ø–∞—Ö–∏
            ctx.drawImage(turtle, turtleState.x - 40, turtleState.y - 40, 80, 80);
        }

        function clear() {
            resetStage();
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function chaseMouse() {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –º—ã—à–∏
            for (let i = 0; i < 10 && turtleState.isRunning; i++) {
                await moveTurtle(10);
                await delay(100);
            }
        }

        function enableWASDControls() {
            // WASD —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∂–µ –≤–∫–ª—é—á–µ–Ω–æ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            console.log("WASD —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ");
        }

        // –§—É–Ω–∫—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Ñ–∏–≥—É—Ä
        async function drawSquare() {
            turtleState.penDown = true;
            for (let i = 0; i < 4 && turtleState.isRunning; i++) {
                await moveTurtle(100);
                turnTurtle(90);
                await delay(100);
            }
        }

        async function drawTriangle() {
            turtleState.penDown = true;
            for (let i = 0; i < 3 && turtleState.isRunning; i++) {
                await moveTurtle(100);
                turnTurtle(120);
                await delay(100);
            }
        }

        async function drawCircle() {
            turtleState.penDown = true;
            for (let i = 0; i < 36 && turtleState.isRunning; i++) {
                await moveTurtle(10);
                turnTurtle(10);
                await delay(50);
            }
        }

        async function drawStar() {
            turtleState.penDown = true;
            for (let i = 0; i < 5 && turtleState.isRunning; i++) {
                await moveTurtle(100);
                turnTurtle(144);
                await delay(100);
            }
        }

        async function drawSpiral() {
            turtleState.penDown = true;
            for (let i = 0; i < 50 && turtleState.isRunning; i++) {
                await moveTurtle(i * 2);
                turnTurtle(89);
                await delay(50);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getBlocksAfter(block) {
            const blocks = Array.from(codeArea.children);
            const index = blocks.indexOf(block);
            return blocks.slice(index + 1);
        }

        function updateTurtlePosition() {
            turtle.style.left = (turtleState.x - 40) + 'px';
            turtle.style.top = (turtleState.y - 40) + 'px';
            turtle.style.transform = `rotate(${360 - turtleState.direction}deg)`;
            turtle.style.display = turtleState.visible ? 'block' : 'none';
        }

        function resetStage() {
            ctx.clearRect(0, 0, stage.width, stage.height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, stage.width, stage.height);
        }

        function updateSensors() {
            document.getElementById('turtle-x').textContent = Math.round(turtleState.x);
            document.getElementById('turtle-y').textContent = Math.round(turtleState.y);
            document.getElementById('turtle-direction').textContent = turtleState.direction + '¬∞';
        }

        function updateTimer() {
            if (turtleState.isRunning) {
                turtleState.timer = (Date.now() - turtleState.timerStart) / 1000;
                document.getElementById('timer-value').textContent = turtleState.timer.toFixed(1);
            }
        }

        function updateBlockCount() {
            const count = codeArea.querySelectorAll('.code-line').length;
            document.getElementById('block-count').textContent = count;
        }

        function stopProgram() {
            turtleState.isRunning = false;
            isExecuting = false;
            document.getElementById('status').textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            document.getElementById('run-btn').disabled = false;
        }

        function clearProgram() {
            codeArea.innerHTML = '';
            updateBlockCount();
        }

        function resetAll() {
            clearProgram();
            resetStage();
            turtleState.x = stage.width / 2;
            turtleState.y = stage.height / 2;
            turtleState.direction = 90;
            turtleState.visible = true;
            turtleState.penDown = true;
            turtleState.timer = 0;
            turtleState.timerStart = Date.now();
            updateTurtlePosition();
            updateSensors();
            document.getElementById('status').textContent = '–ì–æ—Ç–æ–≤';
            document.getElementById('execution-time').textContent = '0';
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        function handleKeyDown(e) {
            pressedKeys.add(e.key.toLowerCase());
            
            if (isExecuting) return;
            
            // WASD —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            if (pressedKeys.has('w')) moveTurtle(10);
            if (pressedKeys.has('s')) moveTurtle(-10);
            if (pressedKeys.has('a')) turnTurtle(15);
            if (pressedKeys.has('d')) turnTurtle(-15);
        }

        function handleKeyUp(e) {
            pressedKeys.delete(e.key.toLowerCase());
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = init;
    </script>
</body>
</html>
