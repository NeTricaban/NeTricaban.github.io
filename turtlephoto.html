<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>turtlephoto</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid #e63946;
            box-shadow: 0 0 15px rgba(230, 57, 70, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #e63946;
            text-transform: lowercase;
            text-shadow: 0 0 10px rgba(230, 57, 70, 0.5);
        }
        
        .creator {
            font-size: 1rem;
            color: #a8dadc;
            margin-bottom: 20px;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .upload-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #457b9d;
            box-shadow: 0 0 10px rgba(69, 123, 157, 0.3);
        }
        
        .preview-section {
            flex: 2;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #f1faee;
            box-shadow: 0 0 10px rgba(241, 250, 238, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .section-title {
            color: #f1faee;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid;
        }
        
        .upload-title {
            border-color: #457b9d;
        }
        
        .preview-title {
            border-color: #f1faee;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #a8dadc;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            background: #457b9d;
            border-radius: 5px;
            height: 6px;
        }
        
        input[type="file"] {
            width: 100%;
            padding: 10px;
            background: rgba(69, 123, 157, 0.3);
            border: 1px solid #457b9d;
            border-radius: 5px;
            color: #f1faee;
            margin: 10px 0;
        }
        
        button {
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            margin: 5px 0;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .filter-btn {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .turtle-filter-btn {
            background: linear-gradient(135deg, #2a9d8f, #1d7874);
            border: 1px solid #2a9d8f;
        }
        
        .turtle-filter-btn:hover {
            background: linear-gradient(135deg, #1d7874, #2a9d8f);
        }
        
        .yellow-filter-btn {
            background: linear-gradient(135deg, #e9c46a, #f4a261);
            border: 1px solid #e9c46a;
        }
        
        .yellow-filter-btn:hover {
            background: linear-gradient(135deg, #f4a261, #e9c46a);
        }
        
        .bw-filter-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            border: 1px solid #6c757d;
        }
        
        .bw-filter-btn:hover {
            background: linear-gradient(135deg, #495057, #6c757d);
        }
        
        .reset-filter-btn {
            background: linear-gradient(135deg, #e63946, #d90429);
            border: 1px solid #e63946;
        }
        
        .reset-filter-btn:hover {
            background: linear-gradient(135deg, #d90429, #e63946);
        }
        
        .add-turtle-btn {
            background: linear-gradient(135deg, #457b9d, #1d3557);
            border: 1px solid #457b9d;
            width: 100%;
        }
        
        .add-turtle-btn:hover {
            background: linear-gradient(135deg, #1d3557, #457b9d);
        }
        
        .download-btn {
            background: linear-gradient(135deg, #e63946, #d90429);
            padding: 15px 30px;
            font-size: 1.1rem;
            margin-top: 20px;
            border: 1px solid #e63946;
        }
        
        .download-btn:hover {
            background: linear-gradient(135deg, #d90429, #e63946);
        }
        
        #imagePreview {
            max-width: 100%;
            max-height: 500px;
            border: 2px solid #f1faee;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(241, 250, 238, 0.2);
            cursor: move;
        }
        
        .turtle-container {
            position: relative;
            display: inline-block;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #a8dadc;
            box-shadow: 0 0 10px rgba(168, 218, 220, 0.3);
        }
        
        .instructions h3 {
            color: #a8dadc;
            margin-bottom: 10px;
            border-bottom: 1px solid #a8dadc;
            padding-bottom: 5px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            color: #f1faee;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #a8dadc;
            font-size: 0.9rem;
            border-top: 1px solid #457b9d;
        }
        
        .color-highlight {
            color: #e63946;
            font-weight: bold;
        }
        
        .filter-description {
            font-size: 0.8rem;
            color: #a8dadc;
            margin-top: 5px;
            font-style: italic;
        }
        
        .drag-hint {
            color: #a8dadc;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>turtlephoto</h1>
            <div class="creator">создатель: NeTricaban</div>
            <p>Загрузите фото и добавьте <span class="color-highlight">черепах</span> с различными эффектами</p>
        </header>
        
        <div class="main-content">
            <div class="upload-section">
                <h2 class="section-title upload-title">Загрузка фото</h2>
                <input type="file" id="imageUpload" accept="image/*">
                <button class="add-turtle-btn" id="addTurtleBtn">Добавить черепаху</button>
                
                <div class="controls">
                    <div class="control-group">
                        <label for="turtleSize">Размер черепахи: <span id="turtleSizeValue">150</span>px</label>
                        <input type="range" id="turtleSize" min="50" max="400" value="150">
                    </div>
                    
                    <div class="control-group">
                        <label for="turtleRotation">Поворот черепахи: <span id="turtleRotationValue">0</span>°</label>
                        <input type="range" id="turtleRotation" min="0" max="360" value="0">
                    </div>
                </div>
                
                <h3 class="section-title upload-title">Фильтры</h3>
                <button class="filter-btn turtle-filter-btn" id="turtleFilter">Фильтр Черепаха</button>
                <div class="filter-description">Зеленый оттенок + блюр + черепахи по углам</div>
                
                <button class="filter-btn yellow-filter-btn" id="yellowFilter">Желтый фильтр (Eminem)</button>
                <button class="filter-btn bw-filter-btn" id="bwFilter">Черно-белый</button>
                <button class="filter-btn reset-filter-btn" id="resetFilter">Сбросить фильтры</button>
                
                <h3 class="section-title upload-title">Эффекты</h3>
                <div class="controls">
                    <div class="control-group">
                        <label for="brightness">Яркость: <span id="brightnessValue">100</span>%</label>
                        <input type="range" id="brightness" min="0" max="200" value="100">
                    </div>
                    
                    <div class="control-group">
                        <label for="contrast">Контраст: <span id="contrastValue">100</span>%</label>
                        <input type="range" id="contrast" min="0" max="200" value="100">
                    </div>
                    
                    <div class="control-group">
                        <label for="saturation">Насыщенность: <span id="saturationValue">100</span>%</label>
                        <input type="range" id="saturation" min="0" max="200" value="100">
                    </div>
                    
                    <div class="control-group">
                        <label for="blur">Блюр: <span id="blurValue">0</span>px</label>
                        <input type="range" id="blur" min="0" max="10" value="0" step="0.1">
                    </div>
                </div>
            </div>
            
            <div class="preview-section">
                <h2 class="section-title preview-title">Предпросмотр</h2>
                <div class="turtle-container">
                    <canvas id="imagePreview"></canvas>
                </div>
                <div class="drag-hint">💡 Перетаскивайте черепах мышкой для перемещения</div>
                <button class="download-btn" id="downloadBtn">Скачать изображение</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>Как использовать:</h3>
            <ol>
                <li>Загрузите фото с помощью кнопки "Выберите файл"</li>
                <li>Нажмите "Добавить черепаху" чтобы разместить черепаху на фото</li>
                <li>Перетащите черепаху в нужное место (удерживайте и перемещайте мышкой)</li>
                <li>Используйте фильтры и эффекты для изменения внешнего вида фото</li>
                <li>Нажмите "Скачать изображение" чтобы сохранить результат</li>
            </ol>
        </div>
        
        <footer>
            <p>turtlephoto &copy; 2025 | Создано NeTricaban</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const addTurtleBtn = document.getElementById('addTurtleBtn');
            const turtleSize = document.getElementById('turtleSize');
            const turtleRotation = document.getElementById('turtleRotation');
            const turtleFilter = document.getElementById('turtleFilter');
            const yellowFilter = document.getElementById('yellowFilter');
            const bwFilter = document.getElementById('bwFilter');
            const resetFilter = document.getElementById('resetFilter');
            const brightness = document.getElementById('brightness');
            const contrast = document.getElementById('contrast');
            const saturation = document.getElementById('saturation');
            const blur = document.getElementById('blur');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // Элементы для отображения значений
            const turtleSizeValue = document.getElementById('turtleSizeValue');
            const turtleRotationValue = document.getElementById('turtleRotationValue');
            const brightnessValue = document.getElementById('brightnessValue');
            const contrastValue = document.getElementById('contrastValue');
            const saturationValue = document.getElementById('saturationValue');
            const blurValue = document.getElementById('blurValue');
            
            const ctx = imagePreview.getContext('2d');
            let originalImage = null;
            let turtles = [];
            let activeTurtle = null;
            let offsetX, offsetY;
            let cornerTurtles = [];
            let isDragging = false;
            
            // Обновление значений ползунков
            turtleSize.addEventListener('input', function() {
                turtleSizeValue.textContent = this.value;
                if (activeTurtle) {
                    activeTurtle.size = parseInt(this.value);
                    drawImage();
                }
            });
            
            turtleRotation.addEventListener('input', function() {
                turtleRotationValue.textContent = this.value;
                if (activeTurtle) {
                    activeTurtle.rotation = parseInt(this.value);
                    drawImage();
                }
            });
            
            brightness.addEventListener('input', function() {
                brightnessValue.textContent = this.value;
                drawImage();
            });
            
            contrast.addEventListener('input', function() {
                contrastValue.textContent = this.value;
                drawImage();
            });
            
            saturation.addEventListener('input', function() {
                saturationValue.textContent = this.value;
                drawImage();
            });
            
            blur.addEventListener('input', function() {
                blurValue.textContent = this.value;
                drawImage();
            });
            
            // Загрузка изображения
            imageUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = new Image();
                        img.onload = function() {
                            // Ограничиваем максимальный размер для производительности
                            const maxWidth = 800;
                            const maxHeight = 600;
                            let width = img.width;
                            let height = img.height;
                            
                            if (width > maxWidth) {
                                height = (maxWidth / width) * height;
                                width = maxWidth;
                            }
                            
                            if (height > maxHeight) {
                                width = (maxHeight / height) * width;
                                height = maxHeight;
                            }
                            
                            imagePreview.width = width;
                            imagePreview.height = height;
                            originalImage = img;
                            turtles = [];
                            cornerTurtles = [];
                            drawImage();
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Добавление черепахи
            addTurtleBtn.addEventListener('click', function() {
                if (!originalImage) {
                    alert('Пожалуйста, сначала загрузите изображение');
                    return;
                }
                
                const turtle = {
                    x: imagePreview.width / 2 - parseInt(turtleSize.value)/2,
                    y: imagePreview.height / 2 - parseInt(turtleSize.value)/2,
                    size: parseInt(turtleSize.value),
                    rotation: parseInt(turtleRotation.value),
                    image: new Image()
                };
                
                turtle.image.onload = function() {
                    turtles.push(turtle);
                    drawImage();
                };
                
                turtle.image.src = 'https://png.pngtree.com/png-clipart/20231001/original/pngtree-red-eared-brazilian-slider-turtle-trachemys-scripta-isolated-png-image_13025113.png';
            });
            
            // Фильтры
            turtleFilter.addEventListener('click', function() {
                applyTurtleFilter();
            });
            
            yellowFilter.addEventListener('click', function() {
                applyYellowFilter();
            });
            
            bwFilter.addEventListener('click', function() {
                applyBWFilter();
            });
            
            resetFilter.addEventListener('click', function() {
                resetFilters();
            });
            
            // Скачивание изображения
            downloadBtn.addEventListener('click', function() {
                if (!originalImage) {
                    alert('Пожалуйста, сначала загрузите изображение');
                    return;
                }
                
                // Создаем временный canvas для скачивания
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                tempCanvas.width = imagePreview.width;
                tempCanvas.height = imagePreview.height;
                
                // Отрисовываем изображение с фильтрами
                tempCtx.filter = getFilterString();
                tempCtx.drawImage(originalImage, 0, 0, tempCanvas.width, tempCanvas.height);
                
                // Отрисовываем обычные черепахи
                turtles.forEach(turtle => {
                    tempCtx.save();
                    tempCtx.translate(turtle.x + turtle.size/2, turtle.y + turtle.size/2);
                    tempCtx.rotate(turtle.rotation * Math.PI / 180);
                    tempCtx.drawImage(turtle.image, -turtle.size/2, -turtle.size/2, turtle.size, turtle.size);
                    tempCtx.restore();
                });
                
                // Отрисовываем черепах по углам (для фильтра)
                cornerTurtles.forEach(turtle => {
                    tempCtx.save();
                    tempCtx.translate(turtle.x + turtle.size/2, turtle.y + turtle.size/2);
                    tempCtx.rotate(turtle.rotation * Math.PI / 180);
                    tempCtx.drawImage(turtle.image, -turtle.size/2, -turtle.size/2, turtle.size, turtle.size);
                    tempCtx.restore();
                });
                
                // Создаем ссылку для скачивания
                const link = document.createElement('a');
                link.download = 'turtlephoto_' + Date.now() + '.png';
                link.href = tempCanvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            
            // Отрисовка изображения с черепахами и эффектами
            function drawImage() {
                if (!originalImage) return;
                
                ctx.clearRect(0, 0, imagePreview.width, imagePreview.height);
                ctx.filter = getFilterString();
                ctx.drawImage(originalImage, 0, 0, imagePreview.width, imagePreview.height);
                
                // Отрисовка обычных черепах
                turtles.forEach(turtle => {
                    ctx.save();
                    ctx.translate(turtle.x + turtle.size/2, turtle.y + turtle.size/2);
                    ctx.rotate(turtle.rotation * Math.PI / 180);
                    ctx.drawImage(turtle.image, -turtle.size/2, -turtle.size/2, turtle.size, turtle.size);
                    ctx.restore();
                });
                
                // Отрисовка черепах по углам (для фильтра)
                cornerTurtles.forEach(turtle => {
                    ctx.save();
                    ctx.translate(turtle.x + turtle.size/2, turtle.y + turtle.size/2);
                    ctx.rotate(turtle.rotation * Math.PI / 180);
                    ctx.drawImage(turtle.image, -turtle.size/2, -turtle.size/2, turtle.size, turtle.size);
                    ctx.restore();
                });
            }
            
            // Получение строки фильтра для canvas
            function getFilterString() {
                const brightnessVal = parseInt(brightness.value);
                const contrastVal = parseInt(contrast.value);
                const saturationVal = parseInt(saturation.value);
                const blurVal = parseFloat(blur.value);
                
                return `brightness(${brightnessVal}%) contrast(${contrastVal}%) saturate(${saturationVal}%) blur(${blurVal}px)`;
            }
            
            // Применение фильтра черепахи
            function applyTurtleFilter() {
                brightness.value = 95;
                brightnessValue.textContent = '95';
                contrast.value = 110;
                contrastValue.textContent = '110';
                saturation.value = 120;
                saturationValue.textContent = '120';
                blur.value = 1.5;
                blurValue.textContent = '1.5';
                
                // Добавляем черепах по углам
                cornerTurtles = [];
                const turtleSize = 80;
                
                // Левый верхний угол
                cornerTurtles.push({
                    x: 10,
                    y: 10,
                    size: turtleSize,
                    rotation: 45,
                    image: new Image()
                });
                
                // Правый верхний угол
                cornerTurtles.push({
                    x: imagePreview.width - turtleSize - 10,
                    y: 10,
                    size: turtleSize,
                    rotation: -45,
                    image: new Image()
                });
                
                // Левый нижний угол
                cornerTurtles.push({
                    x: 10,
                    y: imagePreview.height - turtleSize - 10,
                    size: turtleSize,
                    rotation: 135,
                    image: new Image()
                });
                
                // Правый нижний угол
                cornerTurtles.push({
                    x: imagePreview.width - turtleSize - 10,
                    y: imagePreview.height - turtleSize - 10,
                    size: turtleSize,
                    rotation: -135,
                    image: new Image()
                });
                
                // Загружаем изображения черепах
                cornerTurtles.forEach(turtle => {
                    turtle.image.onload = function() {
                        drawImage();
                    };
                    turtle.image.src = 'https://png.pngtree.com/png-clipart/20231001/original/pngtree-red-eared-brazilian-slider-turtle-trachemys-scripta-isolated-png-image_13025113.png';
                });
                
                drawImage();
            }
            
            // Применение желтого фильтра (Eminem)
            function applyYellowFilter() {
                brightness.value = 110;
                brightnessValue.textContent = '110';
                contrast.value = 120;
                contrastValue.textContent = '120';
                saturation.value = 130;
                saturationValue.textContent = '130';
                blur.value = 0;
                blurValue.textContent = '0';
                cornerTurtles = [];
                drawImage();
            }
            
            // Применение черно-белого фильтра
            function applyBWFilter() {
                brightness.value = 100;
                brightnessValue.textContent = '100';
                contrast.value = 120;
                contrastValue.textContent = '120';
                saturation.value = 0;
                saturationValue.textContent = '0';
                blur.value = 0;
                blurValue.textContent = '0';
                cornerTurtles = [];
                drawImage();
            }
            
            // Сброс фильтров
            function resetFilters() {
                brightness.value = 100;
                brightnessValue.textContent = '100';
                contrast.value = 100;
                contrastValue.textContent = '100';
                saturation.value = 100;
                saturationValue.textContent = '100';
                blur.value = 0;
                blurValue.textContent = '0';
                cornerTurtles = [];
                drawImage();
            }
            
            // Перетаскивание черепах
            imagePreview.addEventListener('mousedown', startDrag);
            imagePreview.addEventListener('touchstart', startDragTouch);
            
            function startDrag(e) {
                e.preventDefault();
                const rect = imagePreview.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                handleDragStart(x, y);
            }
            
            function startDragTouch(e) {
                e.preventDefault();
                const rect = imagePreview.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                handleDragStart(x, y);
            }
            
            function handleDragStart(x, y) {
                // Проверяем, была ли нажата черепаха
                for (let i = turtles.length - 1; i >= 0; i--) {
                    const turtle = turtles[i];
                    
                    // Проверка попадания в область черепахи
                    if (x >= turtle.x && x <= turtle.x + turtle.size && 
                        y >= turtle.y && y <= turtle.y + turtle.size) {
                        activeTurtle = turtle;
                        offsetX = x - turtle.x;
                        offsetY = y - turtle.y;
                        isDragging = true;
                        imagePreview.style.cursor = 'grabbing';
                        break;
                    }
                }
            }
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', dragTouch);
            
            function drag(e) {
                if (!isDragging || !activeTurtle) return;
                e.preventDefault();
                const rect = imagePreview.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                handleDrag(x, y);
            }
            
            function dragTouch(e) {
                if (!isDragging || !activeTurtle) return;
                e.preventDefault();
                const rect = imagePreview.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                handleDrag(x, y);
            }
            
            function handleDrag(x, y) {
                activeTurtle.x = x - offsetX;
                activeTurtle.y = y - offsetY;
                
                // Ограничение перемещения в пределах canvas
                activeTurtle.x = Math.max(0, Math.min(imagePreview.width - activeTurtle.size, activeTurtle.x));
                activeTurtle.y = Math.max(0, Math.min(imagePreview.height - activeTurtle.size, activeTurtle.y));
                
                drawImage();
            }
            
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchend', stopDrag);
            
            function stopDrag() {
                if (isDragging) {
                    isDragging = false;
                    activeTurtle = null;
                    imagePreview.style.cursor = 'default';
                }
            }
        });
    </script>
</body>
</html>
